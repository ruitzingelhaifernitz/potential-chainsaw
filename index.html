<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Flappy Pizza Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #222;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }
    #canvas-container {
      width: 100vw;
      height: 100vh;
      max-width: 480px;
      max-height: 640px;
      margin: auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    canvas {
      width: 100%;
      height: auto;
      display: block;
      image-rendering: pixelated;
      background: #111;
    }
    #splash, #winSplash {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.8);
      color: white;
      text-align: center;
      z-index: 10;
    }
    #winSplash video {
      width: 90%;
      max-width: 640px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    #winSplash button {
      padding: 10px 20px;
      font-size: 18px;
      background: orange;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="canvas-container">
    <canvas id="game" width="480" height="640"></canvas>
  </div>

  <div id="splash">
    <h1>Flappy Pizza</h1>
    <p>Tap / click / spacebar to flap!</p>
  </div>

  <div id="winSplash" style="display:none;">
    <h1>You Win!</h1>
    <video src="pepperonihat.mp4" autoplay loop muted playsinline></video>
    <button id="restartBtn">Play Again</button>
  </div>

  <script>
  (() => {
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const pizzaImg = new Image();
    pizzaImg.src = 'SpinachAndPesto-3dTest.jpg';

    const ovenImg = new Image();
    ovenImg.src = 'Oven_1.png';

    const lidlImg = new Image();
    lidlImg.src = 'LIDL_LOGO_cropped_40x40.png';

    const splash = document.getElementById('splash');
    const winSplash = document.getElementById('winSplash');
    const restartBtn = document.getElementById('restartBtn');

    const GRAVITY = 0.5;
    const FLAP = -8;
    const GAP = 180;
    const OBSTACLE_INTERVAL = 90;
    const PLAYER_RADIUS = 20;
    const OVEN_WIDTH = 107;
    const OVEN_HEIGHT = 100;

    let player = { x: 80, y: 320, vy: 0 };
    let frame = 0;
    let obstacles = [];
    let ovens = [];
    let flapCount = 0;
    let passed = 0;
    let gameState = 'splash';

    function reset() {
      player.y = 320;
      player.vy = 0;
      obstacles = [];
      ovens = [];
      frame = 0;
      passed = 0;
    }

    function flap() {
      player.vy = FLAP;
      if (navigator.vibrate) navigator.vibrate(50);
    }

    function addObstacle() {
      const top = Math.random() * (canvas.height - GAP - 100) + 20;
      obstacles.push({
        x: canvas.width,
        top,
        bottom: top + GAP,
        passed: false
      });

      if (obstacles.length % 4 === 0) {
        ovens.push({
          x: canvas.width + 60,
          y: canvas.height - OVEN_HEIGHT,
          hit: false
        });
      }
    }

    function update() {
      if (gameState !== 'playing') return;

      player.vy += GRAVITY;
      player.y += player.vy;

      if (frame % OBSTACLE_INTERVAL === 0) addObstacle();

      for (let obs of obstacles) obs.x -= 2;
      for (let oven of ovens) oven.x -= 2;

      // Remove offscreen
      obstacles = obstacles.filter(obs => obs.x + 40 > 0);
      ovens = ovens.filter(o => o.x + OVEN_WIDTH > 0);

      for (let obs of obstacles) {
        // Collision
        if (
          player.x + PLAYER_RADIUS > obs.x &&
          player.x - PLAYER_RADIUS < obs.x + 40 &&
          (player.y - PLAYER_RADIUS < obs.top || player.y + PLAYER_RADIUS > obs.bottom)
        ) {
          gameState = 'dead';
        }

        if (!obs.passed && obs.x + 40 < player.x) {
          obs.passed = true;
          passed++;
        }
      }

      for (let oven of ovens) {
        if (!oven.hit &&
          player.x + PLAYER_RADIUS > oven.x &&
          player.x - PLAYER_RADIUS < oven.x + OVEN_WIDTH &&
          player.y + PLAYER_RADIUS > oven.y
        ) {
          oven.hit = true;
          gameState = 'win';
          setTimeout(() => {
            winSplash.style.display = 'flex';
          }, 1000);
        }
      }

      if (player.y + PLAYER_RADIUS > canvas.height || player.y - PLAYER_RADIUS < 0) {
        gameState = 'dead';
      }

      frame++;
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#111';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Player (circular pizza)
      ctx.save();
      ctx.beginPath();
      ctx.arc(player.x, player.y, PLAYER_RADIUS, 0, Math.PI * 2);
      ctx.clip();
      ctx.drawImage(pizzaImg, player.x - PLAYER_RADIUS, player.y - PLAYER_RADIUS, PLAYER_RADIUS * 2, PLAYER_RADIUS * 2);
      ctx.restore();

      // Obstacles (tiled LIDL logos)
      for (let obs of obstacles) {
        // Top wall
        for (let y = 0; y < obs.top; y += 40) {
          ctx.drawImage(lidlImg, obs.x, y, 40, 40);
        }
        // Bottom wall
        for (let y = obs.bottom; y < canvas.height; y += 40) {
          ctx.drawImage(lidlImg, obs.x, y, 40, 40);
        }
      }

      // Ovens
      for (let oven of ovens) {
        ctx.drawImage(ovenImg, oven.x, oven.y, OVEN_WIDTH, OVEN_HEIGHT);
      }
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    function handleInput() {
      if (gameState === 'splash') {
        splash.style.display = 'none';
        gameState = 'playing';
        reset();
      } else if (gameState === 'playing') {
        flap();
      } else {
        winSplash.style.display = 'none';
        splash.style.display = 'flex';
        gameState = 'splash';
      }
    }

    document.addEventListener('keydown', e => {
      if (e.code === 'Space') handleInput();
    });

    canvas.addEventListener('pointerdown', handleInput);
    splash.addEventListener('pointerdown', handleInput);
    restartBtn.addEventListener('click', handleInput);

    pizzaImg.onload = () => gameLoop();
  })();
  </script>
</body>
</html>
