<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Flappy Pizza Game - Mobile Friendly</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #222;
      color: #fff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      height: 100%;
      overflow: hidden;
    }
    #canvas-container {
      width: 100vw;
      height: 100vh;
      max-width: 480px;
      max-height: 640px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: auto;
    }
    canvas {
      background: #111;
      display: block;
      width: 100%;
      height: auto;
      image-rendering: pixelated;
    }
    #splash, #winSplash {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a1a, #444);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 5;
      user-select: none;
    }
    #splash h1, #winSplash h1 {
      font-size: 48px;
      margin: 0 0 20px;
      color: #f7931e;
      text-shadow: 2px 2px 6px #c63;
    }
    #splash p {
      font-size: 20px;
      margin: 8px 0;
      color: #ddd;
      text-align: center;
      max-width: 300px;
    }
    #splash small, #winSplash small {
      margin-top: 30px;
      color: #aaa;
      font-style: italic;
    }
    #winSplash video {
      width: 688px;
      max-width: 90vw;
      height: auto;
      border: 3px solid #f7931e;
      border-radius: 10px;
      background: black;
      margin-bottom: 20px;
    }
    #winSplash button {
      background: #f7931e;
      border: none;
      color: #222;
      font-weight: bold;
      font-size: 18px;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
  </style>
</head>
<body>
  <div id="canvas-container">
    <canvas id="game" width="480" height="640"></canvas>
  </div>

  <div id="splash">
    <h1>Flappy Pizza</h1>
    <p>Fly the frozen pizza into the oven.<br> Avoid the LIDL logos!</p>
    <p><strong>Tap or press Space</strong> to start</p>
    <small>Made with ❤️ by ChatGPT</small>
  </div>

  <div id="winSplash" style="display:none; flex-direction: column; align-items: center;">
    <h1>You Win!</h1>
    <video id="winVideo" src="pepperonihat.mp4" controls autoplay loop muted playsinline></video>
    <button id="restartBtn">Play Again</button>
    <small>Enjoy the victory pizza!</small>
  </div>

  <script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const splashEl = document.getElementById('splash');
  const winSplashEl = document.getElementById('winSplash');
  const restartBtn = document.getElementById('restartBtn');
  const winVideo = document.getElementById('winVideo');

  const GRAVITY = 0.6;
  const FLAP_STRENGTH = -10;
  const OBSTACLE_SPEED = 2;
  const OBSTACLE_GAP = 260;
  const OBSTACLE_WIDTH = 40;

  const OVEN_NATURAL_WIDTH = 419;
  const OVEN_NATURAL_HEIGHT = 392;
  const OVEN_HEIGHT = 100;
  const OVEN_WIDTH = Math.round(OVEN_HEIGHT * (OVEN_NATURAL_WIDTH / OVEN_NATURAL_HEIGHT));
  const OVEN_TARGET_X = canvas.width - 140;

  const lidlLogo = new Image();
  lidlLogo.src = 'LIDL_LOGO_cropped_40x40.png';

  const ovenImg = new Image();
  ovenImg.src = 'Oven_1.png';

  const pizzaImg = new Image();
  pizzaImg.src = 'SpinachAndPesto-3dTest.jpg';

  let state = 'splash';
  let player, obstacles, obstacleCount, ovenShown, ovenY, ovenX;

  function resetGame() {
    player = { x: 80, y: canvas.height / 2, vy: 0 };
    obstacles = [];
    obstacleCount = 0;
    ovenShown = false;
    ovenX = canvas.width + 400;
    ovenY = null;
  }

  function flap() {
    player.vy = FLAP_STRENGTH;
    if (navigator.vibrate) navigator.vibrate(50);
  }

  function spawnObstacle() {
    const gapY = Math.floor(Math.random() * (canvas.height - OBSTACLE_GAP - 100)) + 50;
    obstacles.push({ x: canvas.width, gapY });
    obstacleCount++;
  }

  function updateGame() {
    player.vy += GRAVITY;
    player.y += player.vy;

    // Spawn obstacles
    if (frame % 90 === 0) {
      spawnObstacle();
    }

    // Show oven after every 4 obstacle pairs
    if (obstacleCount > 0 && obstacleCount % 4 === 0 && !ovenShown) {
      ovenX = canvas.width;
      ovenY = canvas.height - OVEN_HEIGHT;
      ovenShown = true;
    }

    // Move obstacles
    for (let obs of obstacles) {
      obs.x -= OBSTACLE_SPEED;
    }

    // Move oven
    if (ovenShown) {
      ovenX -= OBSTACLE_SPEED;
    }

    // Collision
    for (let obs of obstacles) {
      if (
        player.x + 20 > obs.x && player.x - 20 < obs.x + OBSTACLE_WIDTH &&
        (player.y < obs.gapY || player.y > obs.gapY + OBSTACLE_GAP)
      ) {
        endGame();
      }
    }

    if (ovenShown &&
        player.x + 20 > ovenX && player.x - 20 < ovenX + OVEN_WIDTH &&
        player.y + 20 > ovenY
    ) {
      setTimeout(() => {
        state = 'win';
        winSplashEl.style.display = 'flex';
      }, 500);
      state = 'frozen';
    }

    if (player.y > canvas.height || player.y < 0) endGame();
  }

  function endGame() {
    state = 'splash';
    splashEl.style.display = 'flex';
    resetGame();
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw obstacles
    for (let obs of obstacles) {
      for (let y = 0; y < obs.gapY; y += 40) {
        ctx.drawImage(lidlLogo, obs.x, y, 40, 40);
      }
      for (let y = obs.gapY + OBSTACLE_GAP; y < canvas.height; y += 40) {
        ctx.drawImage(lidlLogo, obs.x, y, 40, 40);
      }
    }

    // Draw oven
    if (ovenShown && ovenY !== null) {
      ctx.drawImage(ovenImg, ovenX, ovenY, OVEN_WIDTH, OVEN_HEIGHT);
    }

    // Draw pizza
    ctx.save();
    ctx.beginPath();
    ctx.arc(player.x, player.y, 20, 0, Math.PI * 2);
    ctx.closePath();
    ctx.clip();
    ctx.drawImage(pizzaImg, player.x - 20, player.y - 20, 40, 40);
    ctx.restore();
  }

  let frame = 0;
  function gameLoop() {
    if (state === 'playing') {
      updateGame();
      draw();
    } else if (state === 'frozen') {
      draw();
    }
    frame++;
    requestAnimationFrame(gameLoop);
  }

  function startGame() {
    splashEl.style.display = 'none';
    winSplashEl.style.display = 'none';
    resetGame();
    state = 'playing';
  }

  document.addEventListener('keydown', e => {
    if (e.code === 'Space') {
      if (state === 'splash') startGame();
      else if (state === 'playing') flap();
    }
  });

  canvas.addEventListener('click', () => {
    if (state === 'splash') startGame();
    else if (state === 'playing') flap();
  });

  canvas.addEventListener('touchstart', e => {
    e.preventDefault();
    if (state === 'splash') startGame();
    else if (state === 'playing') flap();
  }, { passive: false });

  restartBtn.addEventListener('click', () => {
    winSplashEl.style.display = 'none';
    startGame();
  });

  resetGame();
  gameLoop();
  </script>
</body>
</html>
