<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Flappy Pizza Game - Mobile Friendly</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      background: #222;
      color: #fff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      height: 100%;
      overflow: hidden;
    }
    #canvas-container {
      width: 100vw;
      height: 100vh;
      max-width: 480px;
      max-height: 640px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: auto;
    }
    canvas {
      background: #111;
      display: block;
      width: 100%;
      height: auto;
      image-rendering: pixelated;
    }
    #splash, #winSplash {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #1a1a1a, #444);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 5;
      user-select: none;
    }
    #splash h1, #winSplash h1 {
      font-size: 48px;
      margin: 0 0 20px;
      color: #f7931e;
      text-shadow: 2px 2px 6px #c63;
    }
    #splash p {
      font-size: 20px;
      margin: 8px 0;
      color: #ddd;
      text-align: center;
      max-width: 300px;
    }
    #splash small, #winSplash small {
      margin-top: 30px;
      color: #aaa;
      font-style: italic;
    }
    #winSplash video {
      width: 688px;
      max-width: 90vw;
      height: auto;
      border: 3px solid #f7931e;
      border-radius: 10px;
      background: black;
      margin-bottom: 20px;
    }
    #winSplash button {
      background: #f7931e;
      border: none;
      color: #222;
      font-weight: bold;
      font-size: 18px;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #winSplash button:hover {
      background: #e67e22;
    }
  </style>
</head>
<body>
  <div id="canvas-container">
    <canvas id="game" width="480" height="640"></canvas>
  </div>

  <div id="splash">
    <h1>Flappy Pizza</h1>
    <p>Fly the frozen pizza into the oven.<br> Avoid the LIDL logos!</p>
    <p><strong>Tap or press Space</strong> to start</p>
    <small>Made with ❤️ by ChatGPT</small>
  </div>

  <div id="winSplash" style="display:none; flex-direction: column; align-items: center;">
    <h1>You Win!</h1>
    <video id="winVideo" src="pepperonihat.mp4" controls autoplay loop muted playsinline></video>
    <button id="restartBtn">Play Again</button>
    <small>Enjoy the victory pizza!</small>
  </div>

  <script>
  (() => {
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const splashEl = document.getElementById('splash');
    const winSplashEl = document.getElementById('winSplash');
    const restartBtn = document.getElementById('restartBtn');
    const winVideo = document.getElementById('winVideo');

    const GRAVITY = 0.6;
    const FLAP_STRENGTH = -10;
    const OBSTACLE_SPEED = 2;
    const OBSTACLE_GAP = 280;  // Increased gap for easier navigation
    const OBSTACLE_WIDTH = 40;

    const OVEN_NATURAL_WIDTH = 419;
    const OVEN_NATURAL_HEIGHT = 392;
    const OVEN_HEIGHT = 100;
    const OVEN_WIDTH = Math.round(OVEN_HEIGHT * (OVEN_NATURAL_WIDTH / OVEN_NATURAL_HEIGHT));
    const OVEN_TARGET_X = canvas.width - 140;

    const lidlLogo = new Image();
    lidlLogo.src = 'LIDL_LOGO_cropped_40x40.png';

    const ovenImg = new Image();
    ovenImg.src = 'Oven_1.png';

    const pizzaImg = new Image();
    pizzaImg.src = 'SpinachAndPesto-3dTest.jpg';

    let state = 'splash'; // splash, playing, frozen, win
    let player, obstacles, frameCount, ovenX, ovenY, ovenVisible, obstaclesPassed;
    let winTimeout = null;

    function resetGame() {
      player = { x: 80, y: canvas.height / 2, vy: 0 };
      obstacles = [];
      frameCount = 0;
      ovenX = canvas.width + 400; // offscreen initially
      ovenY = null;
      ovenVisible = false;
      obstaclesPassed = 0;
      if (winTimeout) {
        clearTimeout(winTimeout);
        winTimeout = null;
      }
    }

    function flap() {
      if (state !== 'playing') return;
      player.vy = FLAP_STRENGTH;
      if (navigator.vibrate) navigator.vibrate(50);
    }

    function createObstaclePair() {
      const gapY = Math.floor(Math.random() * (canvas.height - OBSTACLE_GAP - 100)) + 50;
      obstacles.push({ x: canvas.width, y: 0, width: OBSTACLE_WIDTH, height: gapY, passed: false });
      obstacles.push({ x: canvas.width, y: gapY + OBSTACLE_GAP, width: OBSTACLE_WIDTH, height: canvas.height - gapY - OBSTACLE_GAP, passed: false });
    }

    function update() {
      if (state !== 'playing') return;

      frameCount++;

      player.vy += GRAVITY;
      player.y += player.vy;

      if (player.y + 20 > canvas.height) {
        player.y = canvas.height - 20;
        endGame('Hit the floor!');
        return;
      }
      if (player.y - 20 < 0) {
        player.y = 20;
        player.vy = 0;
      }

      obstacles.forEach(obs => obs.x -= OBSTACLE_SPEED);
      obstacles = obstacles.filter(obs => obs.x + obs.width > 0);

      if (frameCount % 90 === 0) {
        createObstaclePair();
      }

      obstacles.forEach((obs, i) => {
        if (!obs.passed && i % 2 === 0 && (obs.x + obs.width) < player.x) {
          obstaclesPassed++;
          obs.passed = true;
          if (obstaclesPassed % 4 === 0) {
            ovenVisible = true;
            ovenX = canvas.width;
            ovenY = Math.floor(Math.random() * (canvas.height - OVEN_HEIGHT - 100)) + 50;
          }
        }
      });

      if (ovenVisible) {
        ovenX -= OBSTACLE_SPEED;
        if (ovenX + OVEN_WIDTH < 0) {
          ovenVisible = false;
        }
      }

      for (let obs of obstacles) {
        let closestX = Math.max(obs.x, Math.min(player.x, obs.x + obs.width));
        let closestY = Math.max(obs.y, Math.min(player.y, obs.y + obs.height));
        let dx = player.x - closestX;
        let dy = player.y - closestY;
        if (dx * dx + dy * dy < 20 * 20) {
          endGame('Hit a LIDL logo!');
          return;
        }
      }

      if (ovenVisible && player.x + 20 > ovenX && player.x - 20 < ovenX + OVEN_WIDTH) {
        if (player.y > ovenY && player.y < ovenY + OVEN_HEIGHT) {
          state = 'frozen';
          winTimeout = setTimeout(() => {
            state = 'win';
            winSplashEl.style.display = 'flex';
          }, 600);
          return;
        } else if (player.x > ovenX + OVEN_WIDTH) {
          endGame('Hit the oven wall!');
          return;
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      obstacles.forEach(obs => {
        // top walls
        if (obs.y === 0) {
          for (let y = 0; y < obs.height; y += 40) {
            ctx.drawImage(lidlLogo, obs.x, y, 40, 40);
          }
        } else {
          // bottom walls
          for (let y = obs.y; y < obs.y + obs.height; y += 40) {
            ctx.drawImage(lidlLogo, obs.x, y, 40, 40);
          }
        }
      });

      if (ovenVisible) {
        ctx.drawImage(ovenImg, ovenX, ovenY, OVEN_WIDTH, OVEN_HEIGHT);
      }

      ctx.drawImage(pizzaImg, player.x - 20, player.y - 20, 40, 40);
    }

    function gameLoop() {
      if (state === 'playing') {
        update();
      }
      draw();
      requestAnimationFrame(gameLoop);
    }

    function startGame() {
      if (state === 'splash' || state === 'win') {
        splashEl.style.display = 'none';
        winSplashEl.style.display = 'none';
        resetGame();
        state = 'playing';
      }
    }

    // Listen on the whole body to catch taps anywhere
    document.body.addEventListener('click', e => {
      e.preventDefault();
      if (state === 'splash' || state === 'win') {
        startGame();
      } else if (state === 'playing') {
        flap();
      }
    }, { passive: false });

    document.body.addEventListener('touchstart', e => {
      e.preventDefault();
      if (state === 'splash' || state === 'win') {
        startGame();
      } else if (state === 'playing') {
        flap();
      }
    }, { passive: false });

    window.addEventListener('keydown', e => {
      if (e.code === 'Space') {
        e.preventDefault();
        if (state === 'splash' || state === 'win') {
          startGame();
        } else if (state === 'playing') {
          flap();
        }
      }
    });

    restartBtn.addEventListener('click', () => {
      startGame();
    });

    resetGame();
    gameLoop();
  })();
  </script>
</body>
</html>
